---
import Title from "@/components/title.astro";
import Layout from "@/layouts/Layout.astro";
---

<Layout>
  <Title title="Search Result" />
  <div id="searchWrapper" class="flex flex-col gap-4"></div>
</Layout>

<script>
  import type Article from "@/interfaces/article";

  async function getSearchContent() {
    const kw = new URLSearchParams(window.location.search).get("kw");
    const configResponse = await fetch("/api/config");
    const config = await configResponse.json();
    const response = await fetch(
      `${config.strapiUrl}/api/articles?filters[title][$contains]=${kw}`
    );
    return (await response.json()) || [];
  }

  getSearchContent().then(({ data }: { data: Article[] }) => {
    const searchWrapper = document.getElementById("searchWrapper");
    if (searchWrapper) {
      searchWrapper.innerHTML = data
        .map(
          (item) => `<div class="flex flex-col gap-2">
            <a href="/post/${item.documentId}" class="hover:text-orange-500 dark:hover:text-purple-500 font-bold underline decoration-wavy">${item.title}</a>
            <p>${item.description}</p>
        </div>
        `
        )
        .join("");
    }
  });
</script>
